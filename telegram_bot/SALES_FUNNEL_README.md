# –í–æ—Ä–æ–Ω–∫–∞ –ü—Ä–æ–¥–∞–∂ –¥–ª—è –°–∫–∞–Ω–µ—Ä–∞ –ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ —Å:
- **–ú–∏–Ω–∏-–∫–≤–∏–∑–æ–º** –ø–æ 4 —Å—Ñ–µ—Ä–∞–º –∂–∏–∑–Ω–∏
- **8 —ç—Ç–∞–ø–∞–º–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏** (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –∫–≤–∏–∑ ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ø—Ä–∏–º–µ—Ä—ã ‚Üí —Ç–∞—Ä–∏—Ñ—ã ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí —Ä–∞–±–æ—Ç–∞ ‚Üí –¥–æ–∂–∏–º—ã)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–æ–∂–∏–º–∞–º–∏** —á–µ—Ä–µ–∑ 24/48/72 —á–∞—Å–∞
- **–ü—Ä–æ–≤–µ—Ä–∫–æ–π –æ–ø–ª–∞—Ç—ã** –∏ –ª–∏–º–∏—Ç–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

---

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 1. `sales_funnel_texts.py`
–í—Å–µ —Ç–µ–∫—Å—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ—Ä–æ–Ω–∫–∏:
- `QUIZ_MESSAGE` - –ú–∏–Ω–∏-–∫–≤–∏–∑ "–ß—Ç–æ —É —Ç–µ–±—è –≤ —Ñ–æ–∫—É—Å–µ?"
- `QUIZ_OPTIONS` - 4 –∫–Ω–æ–ø–∫–∏: –û—Ç–Ω–æ—à–µ–Ω–∏—è/–î–µ–Ω—å–≥–∏/–≠–Ω–µ—Ä–≥–∏—è/–†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `QUIZ_EXAMPLES` - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–¥ –∫–∞–∂–¥—É—é —Å—Ñ–µ—Ä—É
- `WELCOME_MESSAGE` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç –ú–µ—Ç–∞ –õ–∏–∑—ã
- `ABOUT_SCANNER` - –û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–∞–Ω–µ—Ä–∞
- `EXAMPLES_MESSAGE` - –ü—Ä–∏–º–µ—Ä—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- `PRICING_MESSAGE` - 4 —Ç–∞—Ä–∏—Ñ–∞
- `AFTER_PAYMENT` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- `FOLLOWUP_24H/48H/72H` - –î–æ–∂–∏–º—ã

### 2. `bot_with_sales_funnel.py`
–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å –≤–æ—Ä–æ–Ω–∫–æ–π –ø—Ä–æ–¥–∞–∂:
- –ú–∏–Ω–∏-–∫–≤–∏–∑ –≤ –Ω–∞—á–∞–ª–µ
- –°–æ—Å—Ç–æ—è–Ω–∏—è: `QUIZ_STATE`, `WAITING_FOR_PHOTO`, `WAITING_FOR_REQUEST`, `WAITING_PAYMENT`, `PAID_USER`
- –ê–≤—Ç–æ–¥–æ–∂–∏–º—ã —á–µ—Ä–µ–∑ asyncio
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã –∏ –ª–∏–º–∏—Ç–æ–≤

---

## –õ–æ–≥–∏–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏ (8 —ç—Ç–∞–ø–æ–≤)

### –≠—Ç–∞–ø 0: –ú–∏–Ω–∏-–∫–≤–∏–∑ (–ø—Ä–∏ /start)

**–¶–µ–ª—å:** –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è + –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: "–ß—Ç–æ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å –≤ —Ñ–æ–∫—É—Å–µ? üåü"
     [üíï –û—Ç–Ω–æ—à–µ–Ω–∏—è] [üí∞ –î–µ–Ω—å–≥–∏] [‚ö° –≠–Ω–µ—Ä–≥–∏—è] [üéØ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è]
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä —Å—Ñ–µ—Ä—ã –≤ `user_sessions[user_id].quiz_answer`
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ `QUIZ_EXAMPLES[—Å—Ñ–µ—Ä–∞]`
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä PDF –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–µ (TODO: –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã)
4. –ö–Ω–æ–ø–∫–∞: "‚ú® –£–∑–Ω–∞—Ç—å –ø—Ä–æ –°–∫–∞–Ω–µ—Ä –ø–æ–¥—Ä–æ–±–Ω–µ–µ"

---

### –≠—Ç–∞–ø 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

**–¢—Ä–∏–≥–≥–µ—Ä:** –ù–∞–∂–∞—Ç–∏–µ "–£–∑–Ω–∞—Ç—å –ø—Ä–æ –°–∫–∞–Ω–µ—Ä"

```
–ü—Ä–∏–≤–µ—Ç üåø –Ø - –ú–µ—Ç–∞ –õ–∏–∑–∞...
[–î–∞, —Ö–æ—á—É –ø—Ä–æ–π—Ç–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ] ‚Üí (–¢–∞—Ä–∏—Ñ—ã)
[–•–æ—á—É —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ] ‚Üí (–û–ø–∏—Å–∞–Ω–∏–µ)
```

---

### –≠—Ç–∞–ø 2: –ß—Ç–æ —Ç–∞–∫–æ–µ –°–∫–∞–Ω–µ—Ä?

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–Ω–æ–ø–∫–∞ "–•–æ—á—É —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ"

```
–°–∫–∞–Ω–µ—Ä –ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...
‚Äì —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –±–ª–æ–∫–∏
‚Äì —É–≤–∏–¥–µ—Ç—å —É—Ç–µ—á–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Äì –ø–æ–ª—É—á–∏—Ç—å —è—Å–Ω–æ—Å—Ç—å

[üìÇ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã] ‚Üí (–ü—Ä–∏–º–µ—Ä—ã)
[‚ö° –ü—Ä–æ–π—Ç–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ] ‚Üí (–¢–∞—Ä–∏—Ñ—ã)
```

**TODO:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –ø–æ 7 —á–∞–∫—Ä–∞–º (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 142)

---

### –≠—Ç–∞–ø 3: –ü—Ä–∏–º–µ—Ä—ã

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã"

```
–í–æ—Ç –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π üëá
[—Å–∫—Ä–∏–Ω—ã PDF]

[‚ú® –•–æ—á—É —Å–≤–æ—ë —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ] ‚Üí (–¢–∞—Ä–∏—Ñ—ã)
```

**TODO:** –î–æ–±–∞–≤–∏—Ç—å 3-5 —Å–∫—Ä–∏–Ω–æ–≤ –ø—Ä–∏–º–µ—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 170-172)

---

### –≠—Ç–∞–ø 4: –¢–∞—Ä–∏—Ñ—ã

**–¢—Ä–∏–≥–≥–µ—Ä:** –õ—é–±–∞—è –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–π—Ç–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" / "–•–æ—á—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"

```
–í—ã–±–µ—Ä–∏ —Å–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ üëá
1Ô∏è‚É£ 1 –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî 4 444 ‚ÇΩ
2Ô∏è‚É£ 3 –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî 9 999 ‚ÇΩ
3Ô∏è‚É£ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≥–æ–¥ ‚Äî 77 777 ‚ÇΩ
4Ô∏è‚É£ –í–ò–ü-–ø–æ–¥–ø–∏—Å–∫–∞ ‚Äî 199 999 ‚ÇΩ

[üí´ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ] ‚Üí https://lizaperman.online/scaner_fullpay
[üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–ø–∏—Å–∞–Ω–∏—é]
```

**TODO:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥–∞—é—â—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é (—Å—Ç—Ä–æ–∫–∞ 198)

---

### –≠—Ç–∞–ø 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã

**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–Ω–æ–ø–∫–∞ "‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª"

```
‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã...

–ï–°–õ–ò –û–ü–õ–ê–ß–ï–ù–û:
  "–ü–æ–∑–¥—Ä–∞–≤–ª—è—é üí´ –¢–≤–æ—ë –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–Ω–µ—Ç—Å—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—ÅüåÄ"
  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–∞–±–æ—Ç–µ —Å–æ —Å–∫–∞–Ω–µ—Ä–æ–º (WAITING_FOR_PHOTO)

–ï–°–õ–ò –ù–ï –û–ü–õ–ê–ß–ï–ù–û:
  "‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É"
  [–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞]
```

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- –°—Ç—Ä–æ–∫–∏ 211-273 –≤ `bot_with_sales_funnel.py`
- **–í–†–ï–ú–ï–ù–ù–û:** –í—Å–µ–º –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (`payment_verified = True`)
- **TODO:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yookassa/Tinkoff API

---

### –≠—Ç–∞–ø 6: –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã (—Ä–∞–±–æ—Ç–∞ —Å–æ —Å–∫–∞–Ω–µ—Ä–æ–º)

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:** `WAITING_FOR_PHOTO` ‚Üí `WAITING_FOR_REQUEST`

–õ–æ–≥–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –±–æ—Ç—É:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ (—Å –ø–æ–¥–ø–∏—Å—å—é –∏–ª–∏ –±–µ–∑)
2. –ï—Å–ª–∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏ ‚Üí –±–æ—Ç –ø—Ä–æ—Å–∏—Ç —Ç–µ–∫—Å—Ç
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ `analyze_with_metamethod()`
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è PDF
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–û—Ç–ª–∏—á–∏–µ:** –°—á—ë—Ç—á–∏–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

```python
user_sessions[user_id].scans_count -= 1  # –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

if remaining > 0:
    "–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å {remaining} —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π"
    [–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑]
else:
    "–≠—Ç–æ –±—ã–ª–æ —Ç–≤–æ—ë –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
    [üí´ –ö—É–ø–∏—Ç—å –µ—â—ë] ‚Üí payment_url
```

---

### –≠—Ç–∞–ø—ã 7-8: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–∂–∏–º—ã

**–§—É–Ω–∫—Ü–∏—è:** `schedule_followups()` (—Å—Ç—Ä–æ–∫–∏ 276-340)

#### –î–æ–∂–∏–º 1 (—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞)

```
–ü—Ä–∏–≤–µ—Ç üåø –ù–∞–ø–æ–º–∏–Ω–∞—é, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–æ–π—Ç–∏ –°–∫–∞–Ω–µ—Ä...
"–≠—Ç–æ –∫–∞–∫ –±—É–¥—Ç–æ –∫—Ç–æ-—Ç–æ –Ω–∞–∫–æ–Ω–µ—Ü –æ–±—ä—è—Å–Ω–∏–ª, —á—Ç–æ —Å–æ –º–Ω–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç" ‚ú®

[üëâ –ü—Ä–æ–π—Ç–∏ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ]
```

**–£—Å–ª–æ–≤–∏–µ:** `payment_status != 'paid'`

#### –î–æ–∂–∏–º 2 (—á–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤)

```
–ò–Ω–æ–≥–¥–∞ –º—ã –∏—â–µ–º –æ—Ç–≤–µ—Ç—ã —Å–Ω–∞—Ä—É–∂–∏‚Ä¶ –ù–æ –°–∫–∞–Ω–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ‚Äî –≤—Å—ë —É–∂–µ –≤–Ω—É—Ç—Ä–∏.

[üëâ –ù–∞—á–∞—Ç—å –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ]
```

**–£—Å–ª–æ–≤–∏–µ:** `payment_status != 'paid'`

#### –î–æ–∂–∏–º 3 (—á–µ—Ä–µ–∑ 72 —á–∞—Å–∞)

```
–ë–ª–∞–≥–æ–¥–∞—Ä—é, —á—Ç–æ –±—ã–ª–∞ –≤ —ç—Ç–æ–º –ø–æ–ª–µ üí´
–ü–æ–∫–∞ —Ç—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—à—å, —Ç–≤–æ–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

[üëâ –ü–µ—Ä–µ–π—Ç–∏ –∫ –°–∫–∞–Ω–µ—Ä—É]
```

**–£—Å–ª–æ–≤–∏–µ:** `payment_status != 'paid'`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `asyncio.create_task()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–∞–∂–¥—ã–π –¥–æ–∂–∏–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—Ç–∏–ª ‚Äî –¥–æ–∂–∏–º—ã –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç—Å—è

---

## UserSession —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```python
class UserSession:
    photo_path = None              # –ü—É—Ç—å –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º—É —Ñ–æ—Ç–æ
    request_text = None            # –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
    username = None                # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    start_time = None              # –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏
    quiz_answer = None             # –í—ã–±–æ—Ä –≤ –∫–≤–∏–∑–µ: relationships/money/energy/realization
    payment_status = None          # None / 'pending' / 'paid'
    funnel_stage = 'start'         # –≠—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏
    last_funnel_message_time = None  # –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    scans_count = 0                # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
    subscription_type = None       # '1scan' / '3scans' / 'year' / 'vip'
```

---

## –°–æ—Å—Ç–æ—è–Ω–∏—è ConversationHandler

1. **QUIZ_STATE** - –ö–≤–∏–∑ –∏ –≤—Å—è –≤–æ—Ä–æ–Ω–∫–∞ –¥–æ –æ–ø–ª–∞—Ç—ã
2. **WAITING_PAYMENT** - –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
3. **WAITING_FOR_PHOTO** - –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ (–ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã)
4. **WAITING_FOR_REQUEST** - –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞
5. **PAID_USER** - –û–ø–ª–∞—Ç–∏–≤—à–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ä–µ–∑–µ—Ä–≤)

---

## TODO: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1. –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã

–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É `/telegram_bot/media/`:

```
media/
‚îú‚îÄ‚îÄ chakras_photo.jpg           # –§–æ—Ç–æ –ø–æ 7 —á–∞–∫—Ä–∞–º (—Å—Ç—Ä–æ–∫–∞ 142)
‚îú‚îÄ‚îÄ pricing_presentation.jpg    # –ü—Ä–æ–¥–∞—é—â–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∞ 198)
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ example1.jpg           # –ü—Ä–∏–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è 1
‚îÇ   ‚îú‚îÄ‚îÄ example2.jpg           # –ü—Ä–∏–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è 2
‚îÇ   ‚îî‚îÄ‚îÄ example3.jpg           # –ü—Ä–∏–º–µ—Ä —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è 3
‚îú‚îÄ‚îÄ quiz_examples/
‚îÇ   ‚îú‚îÄ‚îÄ relationships.pdf      # –ü—Ä–∏–º–µ—Ä –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º
‚îÇ   ‚îú‚îÄ‚îÄ money.pdf             # –ü—Ä–∏–º–µ—Ä –ø–æ –¥–µ–Ω—å–≥–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ energy.pdf            # –ü—Ä–∏–º–µ—Ä –ø–æ —ç–Ω–µ—Ä–≥–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ realization.pdf       # –ü—Ä–∏–º–µ—Ä –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ voice/
    ‚îî‚îÄ‚îÄ liza_promo.ogg        # –ì–æ–ª–æ—Å–æ–≤–æ–µ –æ—Ç –õ–∏–∑—ã —Å –ø—Ä–æ–¥–∞–∂–µ–π
```

### 2. –ì–æ–ª–æ—Å–æ–≤–æ–µ –æ—Ç –õ–∏–∑—ã

**–ì–¥–µ –¥–æ–±–∞–≤–∏—Ç—å:** –ü–æ—Å–ª–µ –∫–≤–∏–∑–∞ –∏–ª–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Å–∫–∞–Ω–µ—Ä–∞

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ handle_quiz_answer() –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 130:
await query.message.reply_voice(
    voice=open('media/voice/liza_promo.ogg', 'rb'),
    caption="–ü–æ—Å–ª—É—à–∞–π, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –õ–∏–∑–∞ –æ –°–∫–∞–Ω–µ—Ä–µ üí´"
)
```

**–ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤ –≥–æ–ª–æ—Å–æ–≤–æ–º:**
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç –õ–∏–∑—ã
- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ú–µ—Ç–∞-–ú–µ—Ç–æ–¥–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—á–∞—Å—Ç–Ω–∏—Ü
- –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (–ø—Ä–æ–π—Ç–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã (–ö–†–ò–¢–ò–ß–ù–û!)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 239):**
```python
# –í–†–ï–ú–ï–ù–ù–û: –¥–∞—ë–º –¥–æ—Å—Ç—É–ø –≤—Å–µ–º
payment_verified = True
```

**–ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**

#### –í–∞—Ä–∏–∞–Ω—Ç –ê: Yookassa (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

```python
from yookassa import Configuration, Payment

Configuration.account_id = '–≤–∞—à_shopId'
Configuration.secret_key = '–≤–∞—à_secretKey'

def check_payment_yookassa(user_id):
    # –ò—â–µ–º –ø–ª–∞—Ç—ë–∂ –ø–æ metadata.user_id
    payments = Payment.list({"status": "succeeded"})

    for payment in payments.items:
        if payment.metadata.get('user_id') == str(user_id):
            return True
    return False

# –í —Ñ—É–Ω–∫—Ü–∏–∏ check_payment():
payment_verified = check_payment_yookassa(user_id)
```

#### –í–∞—Ä–∏–∞–Ω—Ç –ë: Tinkoff

```python
import requests

def check_payment_tinkoff(user_id):
    url = "https://securepay.tinkoff.ru/v2/GetState"
    data = {
        "TerminalKey": "–≤–∞—à_–∫–ª—é—á",
        "OrderId": f"user_{user_id}"
    }
    response = requests.post(url, json=data)
    result = response.json()
    return result.get('Status') == 'CONFIRMED'
```

#### –í–∞—Ä–∏–∞–Ω—Ç –í: Webhook –æ—Ç –ø–ª–∞—Ç—ë–∂–∫–∏

1. –°–æ–∑–¥–∞—Ç—å endpoint `/webhook/payment`
2. –ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
3. –û–±–Ω–æ–≤–ª—è–µ–º `user_sessions[user_id].payment_status = 'paid'`

```python
from flask import Flask, request

app = Flask(__name__)

@app.route('/webhook/payment', methods=['POST'])
def payment_webhook():
    data = request.json
    user_id = data['metadata']['user_id']

    if user_id in user_sessions:
        user_sessions[user_id].payment_status = 'paid'
        user_sessions[user_id].scans_count = get_scans_by_tariff(data['amount'])

    return {"status": "ok"}
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 245):**
```python
user_sessions[user_id].scans_count = 1  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ù—É–∂–Ω–æ:**
```python
def get_scans_by_amount(amount_rub):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ —Å—É–º–º–µ –æ–ø–ª–∞—Ç—ã"""
    if amount_rub >= 199999:
        return 999999  # –í–ò–ü - –±–µ–∑–ª–∏–º–∏—Ç
    elif amount_rub >= 77777:
        return 999999  # –ì–æ–¥ - –±–µ–∑–ª–∏–º–∏—Ç
    elif amount_rub >= 9999:
        return 3
    elif amount_rub >= 4444:
        return 1
    else:
        return 0

# –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–ø–ª–∞—Ç—ã:
amount = payment_data['amount']['value']  # –∏–∑ Yookassa
user_sessions[user_id].scans_count = get_scans_by_amount(amount)
```

### 5. –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª

**–ó–∞–º–µ–Ω–∏—Ç—å –≤ `sales_funnel_texts.py` —Å—Ç—Ä–æ–∫–∞ 174:**
```python
CHANNEL_LINK = "https://t.me/+–í–ê–®–ê_–°–°–´–õ–ö–ê"  # TODO
```

–ù–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª.

---

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–∞)

```bash
cd "/Users/daniillepekhin/My Python/Natalie Zemskova/telegram_bot"
python3 bot_with_sales_funnel.py
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

1. –ó–∞–º–µ–Ω–∏—Ç—å `bot_with_db.py` –Ω–∞ `bot_with_sales_funnel.py`:

```bash
scp bot_with_sales_funnel.py root@31.128.38.177:/opt/Natalie_Zemskova/bot_with_sales_funnel.py
scp sales_funnel_texts.py root@31.128.38.177:/opt/Natalie_Zemskova/sales_funnel_texts.py
```

2. –û–±–Ω–æ–≤–∏—Ç—å systemd service:

```bash
ssh root@31.128.38.177

# –ò–∑–º–µ–Ω–∏—Ç—å ExecStart –≤ /etc/systemd/system/natalie-bot.service
ExecStart=/opt/Natalie_Zemskova/venv/bin/python3 /opt/Natalie_Zemskova/bot_with_sales_funnel.py

systemctl daemon-reload
systemctl restart natalie-bot.service
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω–∞—è –≤–æ—Ä–æ–Ω–∫–∞ –±–µ–∑ –æ–ø–ª–∞—Ç—ã

1. `/start` ‚Üí –∫–≤–∏–∑
2. –í—ã–±—Ä–∞—Ç—å —Å—Ñ–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "üí∞ –î–µ–Ω—å–≥–∏")
3. –£–≤–∏–¥–µ—Ç—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä
4. "–£–∑–Ω–∞—Ç—å –ø—Ä–æ –°–∫–∞–Ω–µ—Ä" ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
5. "–•–æ—á—É —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ" ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ
6. "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã" ‚Üí –ø—Ä–∏–º–µ—Ä—ã
7. "–•–æ—á—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" ‚Üí —Ç–∞—Ä–∏—Ñ—ã
8. –ù–ï –æ–ø–ª–∞—á–∏–≤–∞—Ç—å
9. –ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ ‚Üí –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∂–∏–º 1
10. –ß–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ ‚Üí –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∂–∏–º 2
11. –ß–µ—Ä–µ–∑ 72 —á–∞—Å–∞ ‚Üí –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∂–∏–º 3

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë—ã—Å—Ç—Ä–∞—è –ø–æ–∫—É–ø–∫–∞

1. `/start` ‚Üí –∫–≤–∏–∑ ‚Üí –≤—ã–±—Ä–∞—Ç—å —Å—Ñ–µ—Ä—É
2. "–£–∑–Ω–∞—Ç—å –ø—Ä–æ –°–∫–∞–Ω–µ—Ä"
3. "–î–∞, —Ö–æ—á—É –ø—Ä–æ–π—Ç–∏" ‚Üí —Ç–∞—Ä–∏—Ñ—ã
4. "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ" ‚Üí –æ–ø–ª–∞—Ç–∏—Ç—å
5. "–Ø –æ–ø–ª–∞—Ç–∏–ª" ‚Üí –¥–æ—Å—Ç—É–ø –∫ —Å–∫–∞–Ω–µ—Ä—É
6. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –∏ –∑–∞–ø—Ä–æ—Å
7. –ü–æ–ª—É—á–∏—Ç—å PDF
8. "–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑" ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â—ë —Ñ–æ—Ç–æ
9. –ï—Å–ª–∏ –ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫—É–ø–∏—Ç—å –µ—â—ë

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ –¥–æ–∂–∏–º–∞

1. `/start` ‚Üí –ø—Ä–æ–π—Ç–∏ –¥–æ —Ç–∞—Ä–∏—Ñ–æ–≤
2. –ù–ï –æ–ø–ª–∞—á–∏–≤–∞—Ç—å
3. –ß–µ—Ä–µ–∑ 24—á –ø–æ–ª—É—á–∏—Ç—å –¥–æ–∂–∏–º
4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤ –¥–æ–∂–∏–º–µ ‚Üí —Ç–∞—Ä–∏—Ñ—ã
5. –û–ø–ª–∞—Ç–∏—Ç—å ‚Üí –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø

---

## –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ –ë–î —Ç–∞–±–ª–∏—Ü—É `funnel_analytics`:

```sql
CREATE TABLE funnel_analytics (
    id SERIAL PRIMARY KEY,
    user_id BIGINT,
    quiz_answer TEXT,           -- relationships/money/energy/realization
    funnel_stage TEXT,          -- quiz/welcome/about/examples/pricing/paid
    button_clicked TEXT,        -- –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    reached_payment BOOLEAN,    -- –¥–æ—à—ë–ª –¥–æ –æ–ø–ª–∞—Ç—ã?
    completed_payment BOOLEAN,  -- –æ–ø–ª–∞—Ç–∏–ª?
    followup_sent_24h BOOLEAN,  -- –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–æ–∂–∏–º 24—á?
    followup_sent_48h BOOLEAN,  -- –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–æ–∂–∏–º 48—á?
    followup_sent_72h BOOLEAN,  -- –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–æ–∂–∏–º 72—á?
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏:
- –°–∫–æ–ª—å–∫–æ % –ø—Ä–æ—Ö–æ–¥—è—Ç –∫–≤–∏–∑
- –ö–∞–∫–∞—è —Å—Ñ–µ—Ä–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —á–∞—â–µ
- –ù–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –æ—Ç–≤–∞–ª–∏–≤–∞—é—Ç—Å—è
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–∂–∏–º–æ–≤ (% –æ–ø–ª–∞—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ)

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–î–æ–∂–∏–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ø–∞–º—è—Ç–∏:** –ï—Å–ª–∏ –±–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, —Ç–∞–π–º–µ—Ä—ã —Å–±—Ä–æ—Å—è—Ç—Å—è. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
   - Celery + Redis –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
   - –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `followup_scheduled_at` –≤ –ë–î –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

2. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ:** –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—Å–µ `user_sessions` —Ç–µ—Ä—è—é—Ç—Å—è. –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î:
```sql
ALTER TABLE users ADD COLUMN payment_status TEXT;
ALTER TABLE users ADD COLUMN scans_remaining INTEGER DEFAULT 0;
ALTER TABLE users ADD COLUMN subscription_type TEXT;
```

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∫–ª—é—á–∏ –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –≤ –∫–æ–¥–µ. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ—Ä–æ–Ω–∫–∏ —Å–æ–∑–¥–∞–Ω–∞
2. ‚úÖ –ú–∏–Ω–∏-–∫–≤–∏–∑ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
3. ‚úÖ –ê–≤—Ç–æ–¥–æ–∂–∏–º—ã —á–µ—Ä–µ–∑ asyncio
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã (—Ñ–æ—Ç–æ, PDF –ø—Ä–∏–º–µ—Ä—ã, –≥–æ–ª–æ—Å–æ–≤–æ–µ)
5. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–ø–ª–∞—Ç—ã (Yookassa/Tinkoff)
6. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
7. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
8. ‚è≥ –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤ –ë–î
