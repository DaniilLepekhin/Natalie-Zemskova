# Визуальная схема воронки продаж

```
┌─────────────────────────────────────────────────────────────────────┐
│                          /start (Пользователь)                      │
└──────────────────────────────────┬──────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ЭТАП 0: МИНИ-КВИЗ "Что у тебя в фокусе?"                          │
│                                                                     │
│  [💕 Отношения] [💰 Деньги] [⚡ Энергия] [🎯 Реализация]           │
│                                                                     │
│  Цель: Персонализация + вовлечение                                 │
│  Файл: sales_funnel_texts.py → QUIZ_MESSAGE                        │
└──────────────────────────────────┬──────────────────────────────────┘
                                   │
                     ┌─────────────┼─────────────┬─────────────┐
                     │             │             │             │
                     ▼             ▼             ▼             ▼
            ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐
            │ Отношения  │ │   Деньги   │ │  Энергия   │ │Реализация │
            └─────┬──────┘ └─────┬──────┘ └─────┬──────┘ └─────┬──────┘
                  │              │              │              │
                  └──────────────┴──────────────┴──────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────┐
│  АДАПТИРОВАННЫЙ ПРИМЕР ПО ВЫБРАННОЙ СФЕРЕ                          │
│                                                                     │
│  • Описание как Сканер помогает именно в этой сфере                │
│  • Реальный кейс из практики                                       │
│  • PDF-пример (TODO: добавить файл)                                │
│                                                                     │
│  [✨ Узнать про Сканер подробнее]                                  │
│                                                                     │
│  Файл: QUIZ_EXAMPLES[сфера]                                        │
└──────────────────────────────────┬──────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ЭТАП 1: ПРИВЕТСТВИЕ ОТ МЕТА ЛИЗЫ                                  │
│                                                                     │
│  "Привет 🌿 Я - Мета Лиза..."                                      │
│  • Где можно увидеть своё бессознательное                          │
│  • Что показывает Сканер                                           │
│                                                                     │
│  [Да, хочу пройти сканирование] ──────────┐                        │
│  [Хочу узнать подробнее]                  │                        │
│                                           │                        │
│  Файл: WELCOME_MESSAGE                    │                        │
└────────────────────────────┬──────────────┼─────────────────────────┘
                             │              │
                             │              └──────────────────┐
                             ▼                                 │
┌─────────────────────────────────────────────────────────┐    │
│  ЭТАП 2: ЧТО ТАКОЕ СКАНЕР?                             │    │
│                                                         │    │
│  Фото по 7 чакрам (TODO)                               │    │
│                                                         │    │
│  • Метод диагностики по Мета-Методу                    │    │
│  • Что получаешь: разбор чакр, подключки, вычитка      │    │
│  • Автоматизировано в боте                             │    │
│                                                         │    │
│  [📂 Посмотреть примеры сканирования]                  │    │
│  [⚡ Пройти сканирование] ──────────────────────────────┼────┤
│                                                         │    │
│  Файл: ABOUT_SCANNER                                   │    │
└──────────────────────────────┬──────────────────────────┘    │
                               │                               │
                               ▼                               │
┌─────────────────────────────────────────────────────────┐    │
│  ЭТАП 3: ПРИМЕРЫ СКАНИРОВАНИЙ                          │    │
│                                                         │    │
│  Скрины реальных PDF (TODO: 3-5 примеров)              │    │
│                                                         │    │
│  "Каждое сканирование показывает ПОЧЕМУ там            │    │
│   уходит энергия"                                      │    │
│                                                         │    │
│  [✨ Хочу своё сканирование] ───────────────────────────┼────┤
│                                                         │    │
│  Файл: EXAMPLES_MESSAGE                                │    │
└─────────────────────────────────────────────────────────┘    │
                                                               │
                               ┌───────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────────┐
│  ЭТАП 4: ТАРИФЫ                                                     │
│                                                                     │
│  Продающая презентация (TODO)                                      │
│                                                                     │
│  1️⃣ 1 Сканирование — 4 444 ₽                                       │
│     ✓ Разбор по 7 чакрам                                           │
│     ✓ Анализ подключек                                             │
│                                                                     │
│  2️⃣ 3 Сканирования — 9 999 ₽                                       │
│     ✓ Всё из тарифа 1                                              │
│     ✓ Диагностика от Лизы                                          │
│                                                                     │
│  3️⃣ Подписка на год — 77 777 ₽                                     │
│     ✓ Безлимит сканирований                                        │
│     ✓ Практики, Мета-Энергия                                       │
│                                                                     │
│  4️⃣ ВИП-подписка — 199 999 ₽                                       │
│     ✓ Всё из тарифа 3                                              │
│     ✓ Сессия от Лизы                                               │
│                                                                     │
│  [💫 Перейти к оплате] → https://lizaperman.online/scaner_fullpay  │
│  [🔙 Вернуться к описанию]                                         │
│                                                                     │
│  Файл: PRICING_MESSAGE                                             │
└──────────────────────────────────┬──────────────────────────────────┘
                                   │
                                   ▼
                   ┌───────────────────────────────┐
                   │  Пользователь переходит       │
                   │  на страницу оплаты           │
                   │  (внешний сайт)               │
                   └───────────────┬───────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │                             │
                    ▼                             ▼
          ┌──────────────────┐          ┌─────────────────┐
          │ НЕ ОПЛАТИЛ       │          │ ОПЛАТИЛ         │
          │                  │          │                 │
          │ payment_status = │          │ payment_status =│
          │ None             │          │ 'paid'          │
          └────────┬─────────┘          └────────┬────────┘
                   │                             │
                   │                             ▼
                   │              ┌──────────────────────────────────┐
                   │              │ ЭТАП 5: ПОСЛЕ ОПЛАТЫ             │
                   │              │                                  │
                   │              │ "Поздравляю 💫"                  │
                   │              │ • Ссылка на канал                │
                   │              │ • Инструкция работы со Сканером  │
                   │              │ • Примеры запросов               │
                   │              │                                  │
                   │              │ Состояние → WAITING_FOR_PHOTO    │
                   │              │                                  │
                   │              │ Файл: AFTER_PAYMENT              │
                   │              └────────┬─────────────────────────┘
                   │                       │
                   │                       ▼
                   │              ┌──────────────────────────────────┐
                   │              │ ЭТАП 6: РАБОТА СО СКАНЕРОМ       │
                   │              │                                  │
                   │              │ 1. Отправка фото (с подписью     │
                   │              │    или без)                      │
                   │              │ 2. Отправка текста запроса       │
                   │              │    (если не было подписи)        │
                   │              │ 3. Анализ через GPT-4o           │
                   │              │    (5 этапов, 30-60 сек)         │
                   │              │ 4. Генерация PDF                 │
                   │              │ 5. Отправка результата           │
                   │              │                                  │
                   │              │ scans_count -= 1                 │
                   │              │                                  │
                   │              │ Функция: process_analysis()      │
                   │              └────────┬─────────────────────────┘
                   │                       │
                   │              ┌────────┴─────────┐
                   │              │                  │
                   │              ▼                  ▼
                   │     ┌─────────────────┐  ┌─────────────────┐
                   │     │ Остались скан-я │  │ Лимит исчерпан  │
                   │     │                 │  │                 │
                   │     │ [Провести новый │  │ [💫 Купить ещё] │
                   │     │  анализ]        │  │                 │
                   │     └─────────────────┘  └─────────────────┘
                   │
                   │ (АВТОМАТИЧЕСКИЕ ДОЖИМЫ для неоплативших)
                   │
                   ▼
         ┌─────────────────────────────────────────────┐
         │ ДОЖИМ 1 (через 24 часа)                     │
         │                                             │
         │ "Привет 🌿 Напоминаю..."                    │
         │ • Какие сценарии управляют жизнью           │
         │ • Многие говорят: "наконец объяснил"        │
         │                                             │
         │ [👉 Пройти Сканирование сейчас]             │
         │                                             │
         │ Функция: schedule_followups() + asyncio     │
         │ Файл: FOLLOWUP_24H                          │
         └──────────────────┬──────────────────────────┘
                            │
                            ▼
         ┌─────────────────────────────────────────────┐
         │ ДОЖИМ 2 (через 48 часов)                    │
         │                                             │
         │ "Иногда мы ищем ответы снаружи..."          │
         │ • Ты не сломана                             │
         │ • Время увидеть программы                   │
         │                                             │
         │ [👉 Начать Сканирование]                    │
         │                                             │
         │ Файл: FOLLOWUP_48H                          │
         └──────────────────┬──────────────────────────┘
                            │
                            ▼
         ┌─────────────────────────────────────────────┐
         │ ДОЖИМ 3 (через 72 часа)                     │
         │                                             │
         │ "Благодарю, что была в этом поле 💫"        │
         │ • Пока откладываешь, программы работают     │
         │ • Позволь себе их увидеть                   │
         │                                             │
         │ [👉 Перейти к Сканеру Подсознания]          │
         │                                             │
         │ Файл: FOLLOWUP_72H                          │
         └─────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════

                        КЛЮЧЕВЫЕ ТОЧКИ

┌──────────────────────────────────────────────────────────────────┐
│  Конверсионные моменты:                                          │
│                                                                  │
│  1. Квиз → Адаптированный пример (персонализация)               │
│  2. Пример → "Узнать подробнее" (вовлечение)                    │
│  3. Описание → Примеры (социальное доказательство)              │
│  4. Примеры → Тарифы (готовность к покупке)                     │
│  5. Дожимы → Тарифы (повторное касание)                         │
│                                                                  │
│  Показатели для отслеживания:                                   │
│  • % прохождения квиза                                          │
│  • % перехода на оплату                                         │
│  • % конверсии в оплату                                         │
│  • % конверсии после каждого дожима                             │
│  • Средний чек                                                  │
│  • Какая сфера квиза популярнее                                 │
└──────────────────────────────────────────────────────────────────┘
```

## Состояния ConversationHandler

```python
QUIZ_STATE            # Квиз + вся воронка до оплаты
    ↓
WAITING_PAYMENT       # Ожидание подтверждения оплаты
    ↓
WAITING_FOR_PHOTO     # Ожидание фото (после оплаты)
    ↓
WAITING_FOR_REQUEST   # Ожидание текста запроса
    ↓
ConversationHandler.END
```

## UserSession lifecycle

```python
# При /start
user_sessions[user_id] = UserSession()
user_sessions[user_id].funnel_stage = 'quiz'
user_sessions[user_id].payment_status = None

# После квиза
user_sessions[user_id].quiz_answer = 'relationships'  # или money/energy/realization
user_sessions[user_id].funnel_stage = 'quiz_result'

# При переходе по воронке
funnel_stage = 'welcome' → 'about' → 'examples' → 'pricing'

# После оплаты
user_sessions[user_id].payment_status = 'paid'
user_sessions[user_id].scans_count = 1  # или 3/999999
user_sessions[user_id].subscription_type = '1scan'  # или 3scans/year/vip

# После каждого сканирования
user_sessions[user_id].scans_count -= 1
```

## Асинхронные процессы

```
┌──────────────────────────────────────────┐
│  /start вызван                           │
│  ↓                                       │
│  asyncio.create_task(                    │
│      schedule_followups(user_id)         │
│  )                                       │
│  ↓                                       │
│  Фоновая задача запущена                 │
└──────────────────────────────────────────┘
                ║
                ║ (параллельно основному потоку)
                ║
                ▼
    ┌───────────────────────┐
    │ await sleep(24h)      │
    ├───────────────────────┤
    │ Проверка:             │
    │ if payment != 'paid': │
    │   отправить дожим     │
    └───────────┬───────────┘
                │
                ▼
    ┌───────────────────────┐
    │ await sleep(24h)      │
    ├───────────────────────┤
    │ Проверка:             │
    │ if payment != 'paid': │
    │   отправить дожим     │
    └───────────┬───────────┘
                │
                ▼
    ┌───────────────────────┐
    │ await sleep(24h)      │
    ├───────────────────────┤
    │ Проверка:             │
    │ if payment != 'paid': │
    │   отправить дожим     │
    └───────────────────────┘
```
